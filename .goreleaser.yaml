version: 2

project_name: vdradmin-go

before:
  hooks:
    - go mod tidy
    - go test ./...

builds:
  - id: vdradmin
    dir: .
    main: ./cmd/vdradmin
    binary: vdradmin
    env:
      - CGO_ENABLED=0
    goos:
      - linux
    goarch:
      - amd64
    ldflags:
      - -s -w
      - -X main.version={{.Version}}
      - -X main.commit={{.Commit}}
      - -X main.date={{.Date}}

archives:
  - formats:
      - tar.gz
    name_template: >-
      {{ .ProjectName }}_{{ .Version }}_{{ .Os }}_{{ .Arch }}
    format_overrides:
      - goos: windows
        formats:
          - zip

checksum:
  name_template: checksums.txt

changelog:
  disable: false

  # Use git log for changelog generation.
  # This keeps things working locally and in CI without extra API calls.
  use: git

  # Keep commit ordering from git log (usually newest-first).
  # Setting sort would sort alphabetically by message.
  sort: ""

  # Keep the release notes readable; commit SHAs are usually noise.
  abbrev: -1

  # Add simple icons based on Conventional Commit types.
  # NOTE: This relies on commit subjects like "feat:", "fix:", "chore:", etc.
  format: >-
    {{- $m := .Message -}}
    {{- if ne (trimprefix $m "feat") $m -}}âœ¨ {{ $m }}
    {{- else if ne (trimprefix $m "fix") $m -}}ğŸ› {{ $m }}
    {{- else if ne (trimprefix $m "chore") $m -}}ğŸ§¹ {{ $m }}
    {{- else if ne (trimprefix $m "refactor") $m -}}â™»ï¸ {{ $m }}
    {{- else if ne (trimprefix $m "perf") $m -}}âš¡ï¸ {{ $m }}
    {{- else if ne (trimprefix $m "docs") $m -}}ğŸ“ {{ $m }}
    {{- else if ne (trimprefix $m "build") $m -}}ğŸ—ï¸ {{ $m }}
    {{- else if ne (trimprefix $m "ci") $m -}}ğŸ¤– {{ $m }}
    {{- else if ne (trimprefix $m "test") $m -}}âœ… {{ $m }}
    {{- else if ne (trimprefix $m "deps") $m -}}â¬†ï¸ {{ $m }}
    {{- else if ne (trimprefix $m "revert") $m -}}âª {{ $m }}
    {{- else -}}{{ $m }}{{- end -}}

  # Make changelogs easy to scan: Added / Fixed / Changed.
  # Ordering ensures features (feat) always come first.
  groups:
    - title: "âœ¨ Added"
      regexp: '^feat(\([[:word:]-]+\))?!?:.+$'
      order: 0
    - title: "ğŸ› Fixed"
      regexp: '^fix(\([[:word:]-]+\))?!?:.+$'
      order: 1
    - title: "ğŸ› ï¸ Changed"
      regexp: '^(chore|refactor|perf|build|ci|docs|test|style|deps)(\([[:word:]-]+\))?!?:.+$'
      order: 2
    - title: "ğŸ§© Other"
      order: 999

  filters:
    exclude:
      - '^Merge '
      - '^merge '
      - '^Merge pull request '

release:
  draft: false
  prerelease: auto
