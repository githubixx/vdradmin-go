{{define "timer_edit.html"}}
<!DOCTYPE html>
<html lang="en" {{if eq .ThemeMode "dark"}}data-theme="dark"{{else if eq .ThemeMode "light"}}data-theme="light"{{end}} data-theme-default="{{.ThemeDefault}}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{if .PageTitle}}{{.PageTitle}}{{else}}Edit Timer - VDRAdmin-go{{end}}</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="/static/js/theme.js?v=20260104" defer></script>
</head>
<body>
    {{template "nav_header" .}}

    <main class="container">
        <div class="toolbar">
            <h2 style="font-family: var(--font-display); font-size: 1.25rem; margin-bottom: 0.75rem;">{{if .Heading}}{{.Heading}}{{else}}Edit Timer{{end}}</h2>

            <form action="{{if .FormAction}}{{.FormAction}}{{else}}/timers/update{{end}}" method="post" class="config-grid">
                {{if gt .Timer.ID 0}}<input type="hidden" name="id" value="{{.Timer.ID}}">{{end}}

                <label>Timer Active</label>
                <div class="timer-radio-group">
                    <label><input type="radio" name="active" value="1" {{if .Timer.Active}}checked{{end}}> Yes</label>
                    <label><input type="radio" name="active" value="0" {{if not .Timer.Active}}checked{{end}}> No</label>
                </div>

                <label for="channel">Channel</label>
                <select id="channel" name="channel" required>
                    {{range .Channels}}
                    <option value="{{.ID}}" {{if eq $.SelectedChannel .ID}}selected{{end}}>{{.Name}}</option>
                    {{end}}
                </select>

                <label for="day">Day Of Recording</label>
                <div>
                    <div class="timer-radio-group">
                        <label><input type="radio" name="day_mode" value="single" {{if or (eq .Timer.DayMode "") (eq .Timer.DayMode "single")}}checked{{end}}> Single</label>
                        <label><input type="radio" name="day_mode" value="weekly" {{if eq .Timer.DayMode "weekly"}}checked{{end}}> Weekly</label>
                    </div>

                    <input id="day" type="date" name="day" value="{{.Timer.Day}}">

                    <div id="weekly-days" style="display: flex; flex-wrap: wrap; gap: 0.75rem; margin-top: 0.5rem;">
                        <label><input type="checkbox" name="wd_mon" value="1" {{if .Timer.WDMon}}checked{{end}}> Monday</label>
                        <label><input type="checkbox" name="wd_tue" value="1" {{if .Timer.WDTue}}checked{{end}}> Tuesday</label>
                        <label><input type="checkbox" name="wd_wed" value="1" {{if .Timer.WDWed}}checked{{end}}> Wednesday</label>
                        <label><input type="checkbox" name="wd_thu" value="1" {{if .Timer.WDThu}}checked{{end}}> Thursday</label>
                        <label><input type="checkbox" name="wd_fri" value="1" {{if .Timer.WDFri}}checked{{end}}> Friday</label>
                        <label><input type="checkbox" name="wd_sat" value="1" {{if .Timer.WDSat}}checked{{end}}> Saturday</label>
                        <label><input type="checkbox" name="wd_sun" value="1" {{if .Timer.WDSun}}checked{{end}}> Sunday</label>
                    </div>
                </div>

                <label for="start">Start Time</label>
                <input id="start" type="text" name="start" value="{{.Timer.Start}}" inputmode="numeric" placeholder="HH:MM" pattern="^([01][0-9]|2[0-3]):[0-5][0-9]$" required>

                <label for="stop">End Time</label>
                <input id="stop" type="text" name="stop" value="{{.Timer.Stop}}" inputmode="numeric" placeholder="HH:MM" pattern="^([01][0-9]|2[0-3]):[0-5][0-9]$" required>

                <label for="priority">Priority</label>
                <input id="priority" type="number" name="priority" min="0" max="99" value="{{.Timer.Priority}}" required>

                <label for="lifetime">Lifetime</label>
                <input id="lifetime" type="number" name="lifetime" min="0" max="99" value="{{.Timer.Lifetime}}" required>

                <label for="title">Title Of Recording</label>
                <input id="title" type="text" name="title" value="{{.Timer.Title}}" required>

                <label for="aux">Summary (readonly)</label>
                <textarea id="aux" name="aux" rows="4" readonly>{{.Timer.Aux}}</textarea>

                <div></div>
                <div class="timer-form-actions">
                    <button type="submit" class="btn btn-primary">Save</button>
                    <a href="/timers" class="btn btn-secondary">Cancel</a>
                </div>
            </form>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; {{.Year}} vdradmin-go | <a href="https://github.com/githubixx/vdradmin-go">GitHub</a></p>
        </div>
    </footer>

    <script>
        (function () {
            function updateDayMode() {
                var weekly = document.querySelector('input[name="day_mode"][value="weekly"]');
                var dayInput = document.getElementById('day');
                var weeklyDays = document.getElementById('weekly-days');
                var isWeekly = weekly && weekly.checked;

                if (dayInput) {
                    dayInput.disabled = isWeekly;
                    dayInput.required = !isWeekly;
                }
                if (weeklyDays) {
                    weeklyDays.style.display = isWeekly ? 'flex' : 'none';
                    var checks = weeklyDays.querySelectorAll('input[type="checkbox"]');
                    for (var i = 0; i < checks.length; i++) {
                        checks[i].disabled = !isWeekly;
                    }
                }
            }

            var radios = document.querySelectorAll('input[name="day_mode"]');
            for (var i = 0; i < radios.length; i++) {
                radios[i].addEventListener('change', updateDayMode);
            }
            updateDayMode();
        })();
    </script>
</body>
</html>
{{end}}
