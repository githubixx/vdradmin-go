{{define "nav_header"}}
<header>
    <nav class="container">
        <div class="nav-brand">
            <h1>
                <a href="{{if .BrandHref}}{{.BrandHref}}{{else}}/{{end}}" style="color: inherit; text-decoration: none;">VDRAdmin-go</a>
                {{if .PageName}} - {{.PageName}}{{end}}
            </h1>
        </div>
        <div class="nav-right">
            {{if eq .Role "admin"}}
            <div class="nav-user">
                <span class="badge">Admin</span>
            </div>
            {{end}}

            <details class="nav-burger">
                <summary class="btn btn-secondary btn-menu nav-burger-button" aria-label="Menu">
                    <span class="burger-icon" aria-hidden="true"></span>
                </summary>
                <div class="nav-burger-menu" role="menu">
                    <a href="/now" {{if or (eq .Path "/") (eq .Path "/now")}}class="active" aria-current="page"{{end}}>What's on now</a>
                    <a href="/channels" {{if eq .Path "/channels"}}class="active" aria-current="page"{{end}}>Channels</a>
                    <a href="/playing" {{if eq .Path "/playing"}}class="active" aria-current="page"{{end}}>Playing Today</a>
                    <a href="/timers" {{if eq .Path "/timers"}}class="active" aria-current="page"{{end}}>Timers</a>
                    <a href="/recordings" {{if eq .Path "/recordings"}}class="active" aria-current="page"{{end}}>Recordings</a>
                    <a href="/search" {{if eq .Path "/search"}}class="active" aria-current="page"{{end}}>Search</a>
                    <a href="/epgsearch" {{if eq .Path "/epgsearch"}}class="active" aria-current="page"{{end}}>EPG Search</a>
                    <a href="/configurations" {{if eq .Path "/configurations"}}class="active" aria-current="page"{{end}}>Configurations</a>
                </div>
            </details>

        <script>
            (() => {
                function setupBurgerCloseOnOutsideClick() {
                    const burgers = Array.from(document.querySelectorAll('details.nav-burger'));
                    if (burgers.length === 0) return;

                    document.addEventListener(
                        'click',
                        (e) => {
                            for (const d of burgers) {
                                if (!d.open) continue;
                                if (d.contains(e.target)) continue;
                                d.open = false;
                            }
                        },
                        true
                    );

                    document.addEventListener('keydown', (e) => {
                        if (e.key !== 'Escape') return;
                        for (const d of burgers) {
                            if (!d.open) continue;
                            d.open = false;
                            const summary = d.querySelector('summary');
                            if (summary && typeof summary.focus === 'function') summary.focus();
                        }
                    });
                }

                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', setupBurgerCloseOnOutsideClick);
                } else {
                    setupBurgerCloseOnOutsideClick();
                }
            })();
        </script>
        </div>
    </nav>
</header>
{{end}}
